<div class="app-container">
  <header class="app-header">
    <h1>Examen de Formulaci√≥n</h1>
    <div class="header-controls">
      <button class="mobile-menu-toggle" (click)="toggleMobileMenu()" [class.active]="mobileMenuOpen">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <button class="reset-btn" (click)="reiniciarTodo()">
        <span class="reset-icon">üîÑ</span>
        <span class="reset-text">Reiniciar</span>
      </button>
    </div>
  </header>
  
  <!-- Navegaci√≥n responsive -->
  <nav class="temas-nav" [class.mobile-open]="mobileMenuOpen">
    <div class="nav-container">
      <!-- Navegaci√≥n desktop -->
      <div class="desktop-nav">
        <div
          *ngFor="let tema of temas"
          class="tema-card"
          [class.selected]="tema === temaSeleccionado"
          (click)="seleccionarTema(tema)"
        >
          <div class="tema-numero">{{ tema.id }}</div>
          <div class="tema-content">
            <div class="tema-nombre">{{ tema.nombre }}</div>
            <div class="tema-progreso">
              <span class="progreso-texto">{{ getProgresoPorTema(tema.id).completados }}/{{ getProgresoPorTema(tema.id).total }}</span>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getProgresoPorTema(tema.id).porcentaje"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Navegaci√≥n m√≥vil -->
      <div class="mobile-nav" [class.show]="mobileMenuOpen">
        <div class="mobile-nav-header">
          <h3>Selecciona un Tema</h3>
          <button class="close-mobile-nav" (click)="toggleMobileMenu()">‚úï</button>
        </div>
        <div class="mobile-temas-list">          <div
            *ngFor="let tema of temas"
            class="mobile-tema-item"
            [class.selected]="tema === temaSeleccionado"
            (click)="onTemaClick($event, tema); closeMobileMenu()"
            (touchstart)="onTemaClick($event, tema); closeMobileMenu()"
          >
            <div class="mobile-tema-info">
              <span class="mobile-tema-numero">{{ tema.id }}</span>
              <span class="mobile-tema-nombre">{{ tema.nombre }}</span>
            </div>
            <div class="mobile-progreso">
              <span class="mobile-progreso-texto">{{ getProgresoPorTema(tema.id).completados }}/{{ getProgresoPorTema(tema.id).total }}</span>
              <div class="mobile-progress-bar">
                <div class="mobile-progress-fill" [style.width.%]="getProgresoPorTema(tema.id).porcentaje"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
    <!-- Overlay para m√≥vil -->
  <div class="mobile-overlay" [class.show]="mobileMenuOpen" (click)="onOverlayClick($event)"></div>
    <main class="exercise-section">
    <div *ngIf="temaSeleccionado" class="tema-controls">
      <button class="ver-formulas-btn" (click)="openFormulasModal()">
        <span class="formulas-icon">üìê</span>
        <span class="formulas-text">VER F√ìRMULAS</span>
      </button>
    </div>
    
    <app-exercise *ngIf="temaSeleccionado"></app-exercise><div *ngIf="!temaSeleccionado" class="no-tema-selected">
      <h2>üéØ Selecciona un tema para comenzar</h2>
      <p>Elige uno de los temas para empezar a practicar ejercicios de matem√°ticas financieras.</p>      <div class="tema-grid-preview">
        <div 
          *ngFor="let tema of temas" 
          class="preview-tema" 
          (click)="onTemaClick($event, tema)"
          (touchstart)="onTemaClick($event, tema)"
          [attr.aria-label]="'Seleccionar tema ' + tema.nombre"
          role="button"
          tabindex="0"
          (keydown.enter)="onTemaClick($event, tema)"
          (keydown.space)="onTemaClick($event, tema)"
        >
          <span class="preview-numero">{{ tema.id }}</span>
          <span class="preview-nombre">{{ tema.nombre }}</span>
        </div>      </div>
    </div>
  </main>

  <!-- Modal de F√≥rmulas -->
  <div class="formulas-modal-overlay" [class.show]="formulasModalOpen" (click)="onFormulasOverlayClick($event)">
    <div class="formulas-modal" (click)="$event.stopPropagation()">
      <div class="formulas-modal-header">
        <h3>F√≥rmulas - {{ temaSeleccionado?.nombre }}</h3>
        <button class="close-formulas-btn" (click)="closeFormulasModal()">
          <span>&times;</span>
        </button>
      </div>
      <div class="formulas-modal-content">        <div class="formula-image-container">
          <img 
            [src]="getFormulaImagePath()" 
            [alt]="'F√≥rmulas para ' + temaSeleccionado?.nombre"
            class="formula-image"
            (error)="onImageError($event)"
          />
        </div>
      </div>
    </div>
  </div>
</div>
<router-outlet />
